<!DOCTYPE html>
<html>
  <head>
  <title>PS Cheat-Creator</title>
  <meta charset="utf-8"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"></meta>
  <link rel="icon" type="image/x-icon" href="../../images/MB_Icon_01.png"></link>
  <link rel="stylesheet" href="../../assets/css/main.css"></link>
  <style>
    .table_container {border: 1px solid #444444;border-collapse: separate;border-spacing: 6px;border-collapse: separate;}
    .table_td_var {width: auto;padding: 0.5em;}
    .table_td_025 {width: 25%;padding: 0.5em;}
    .table_td_030 {width: 30%;padding: 0.5em;}
    .table_td_050 {width: 50%;padding: 0.5em;}
    .table_td_070 {width: 70%;padding: 0.5em;}
    .table_td_075 {width: 75%;padding: 0.5em;}
    .table_td_100 {width: 75%;padding: 0.5em;}

    .text_left {text-align: left;}
    .text_right {text-align: right;}
    .text_center {text-align: center;}

    .editable {cursor: pointer;background-color: #080808;}
    .editable:hover {color: #00aa44;background-color: #222222;transition: all 1.5s;}
  </style>
</head>
<body onload="window.location.href = '#playstation';localStorage.getItem('page');" class="is-preload">
  <div id="wrapper">
    
    <nav id="nav">
      <a href="../../index.html"><img class="mb_icon" src="../../images/MB_Icon_02.png"></img><span>Home</span></a>
      <a href="../../Web-Tools/web-tools.html"><img class="mb_icon" src="../../images/Web_Icon_01.png"></img><span>Web-Tools</span></a>
      <a href="../../Local-Tools/local-tools.html"><img class="mb_icon" src="../../images/CMD_Icon_01.png"></img><span>Local-Tools</span></a>
      <a href="../../Games/games.html"><img class="mb_icon" src="../../images/Games_Icon_01.png"></img><span>Games</span></a>
      <a href="#playstation"><img class="mb_icon" src="icon_01.png"></img><span>Cheat-Creator</span></a>
      
    </nav>
    
    <div id="main">
      <article id="playstation" class="panel">
        <div class="tr_flipper_gap"></div>
        <header><h2>Erstelle .shn-File-Cheats für PS4 & PS5</h2></header>
        
        <section>
          <table class="table_container" style="cursor: default;">
            <tr>
              <td class="table_td_025 text_right">Name Des Spiels:</td>
              <td class="table_td_025 text_center editable" colspan="3" contenteditable="true" onfocus="clean(this);" id="game_title"></td>
            </tr>
            <tr>
              <td class="table_td_025 text_right">ID: (CUSA12345)</td>
              <td class="table_td_025 text_center editable" contenteditable="true" onfocus="clean(this);" id="game_id"></td>
              <td class="table_td_025 text_right">Master-Version: (01.00)</td>
              <td class="table_td_025 text_center editable" contenteditable="true" onfocus="clean(this);"  id="game_version"></td>
            </tr>
            <tr>
              <td class="table_td_025 text_right">Genre:</td>
              <td class="table_td_025 text_center editable" contenteditable="true" onfocus="clean(this);" id="game_genre"></td>
              <td class="table_td_025 text_right">Prozess:</td>
              <td class="table_td_025 text_center editable" contenteditable="true" onfocus="clean(this);" id="game_process">eboot.bin</td>
            </tr>
          </table>
        </section>

        <section id="cheat_section">

          <section id="c1">
            <table id="table_c1" class="table_container" style="cursor: default;">
              <tr><td class="table_td_100 text_center" colspan="2">Cheat 1</td></tr>
              <tr>
                <td class="table_td_025 text_right">Beschreibung:</td>
                <td class="table_td_075 editable" contenteditable="true" id="desc1_c1"></td>
              </tr>
              <tr id="address_tr1_c1">
                <td class="table_td_025 text_right">Adresse 1:</td>
                <td class="table_td_075 editable" contenteditable="true" id="address1_c1"></td>
              </tr>
              <tr id="on_tr1_c1">
                <td class="table_td_025 text_right">An:</td>
                <td class="table_td_075 editable" contenteditable="true" id="on1_c1"></td>
              </tr>
              <tr id="off_tr1_c1">
                <td class="table_td_025 text_right">Aus:</td>
                <td class="table_td_075 editable" contenteditable="true" id="off1_c1"></td>
              </tr>
            </table>
            <table class="table_container" style="cursor: default;">
              <tr>
                <td class="table_td_050 text_center editable" onclick="offset_rem(c1);">Offset Entfernen</td>
                <td class="table_td_050 text_center editable" onclick="offset_add(c1);">Offset Hinzufügen</td>
              </tr>
            </table>
          </section>

          <section id="c2">
            <table id="table_c2" class="table_container" style="cursor: default;">
              <tr><td class="table_td_100 text_center" colspan="2">Cheat 1</td></tr>
              <tr>
                <td class="table_td_025 text_right">Beschreibung:</td>
                <td class="table_td_075 editable" contenteditable="true" id="desc1_c2"></td>
              </tr>
            </table>
            <table class="table_container" style="cursor: default;">
              <tr>
                <td class="table_td_050 text_center editable" onclick="offset_rem(c2);">Offset Entfernen</td>
                <td class="table_td_050 text_center editable" onclick="offset_add(c2);">Offset Hinzufügen</td>
              </tr>
            </table>
          </section>
          
        </section>

        <section id="nav_section">
          <table class="design_border_01 design_borderspacing_01" style="cursor: default;">
            <tr>
              <td class="table_td_050 text_center editable" onclick="create_cheat_tables();">File Herunterladen</td>
              <td class="table_td_050 text_center editable" onclick="produce_list();">Cheat Hinzufügen</td>
            </tr>
          </table>
        </section>

        <div class="tr_flipper_gap"></div>
      </article>
    </div>
    
    <div id="footer"><ul class="copyright"><li>&copy; Master B</li></ul></div>

  </div>
</body>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/browser.min.js"></script>
<script src="../../assets/js/breakpoints.min.js"></script>
<script src="../../assets/js/util.js"></script>
<script src="../../assets/js/main.js"></script>

<script>
let cheatCounter = 0;
const container = document.getElementById("cheat_section");

document.querySelectorAll('[contenteditable="true"]').forEach(el => {
  el.addEventListener("paste", function (e) {
    e.preventDefault();
    const text = e.clipboardData.getData("text/plain");
    document.execCommand("insertText", false, text);
  });
});

function produce_list() {
  cheatCounter++;
  const cheatId = "c" + cheatCounter;

  const section = document.createElement("section");
  section.id = cheatId;

  section.innerHTML = `
    <table id="table_${cheatId}" class="table_container">
      <tr>
        <td class="table_td_100 text_center" colspan="2">
          Cheat ${cheatCounter}
        </td>
      </tr>
      <tr>
        <td class="table_td_025 text_right">Beschreibung:</td>
        <td class="table_td_075 editable" contenteditable="true"></td>
      </tr>
    </table>

    <table class="table_container">
      <tr>
        <td class="table_td_050 text_center editable addOffset">
          Offset Hinzufügen
        </td>
        <td class="table_td_050 text_center editable removeCheat">
          Cheat Entfernen
        </td>
      </tr>
    </table>
  `;

  container.appendChild(section);

  // Event Listener setzen
  section.querySelector(".addOffset")
    .addEventListener("click", () => offset_add(cheatId));

  section.querySelector(".removeCheat")
    .addEventListener("click", () => section.remove());
}
function offset_add(cheatId) {
  const table = document.getElementById("table_" + cheatId);

  const offsetCount =
    table.querySelectorAll(".offset-block").length + 1;

  const wrapper = document.createElement("tbody");
  wrapper.classList.add("offset-block");

  wrapper.innerHTML = `
    <tr>
      <td class="table_td_025 text_right">Adresse ${offsetCount}:</td>
      <td class="table_td_075 editable" contenteditable="true"></td>
    </tr>
    <tr>
      <td class="table_td_025 text_right">An:</td>
      <td class="table_td_075 editable" contenteditable="true"></td>
    </tr>
    <tr>
      <td class="table_td_025 text_right">Aus:</td>
      <td class="table_td_075 editable" contenteditable="true"></td>
    </tr>
    <tr>
      <td colspan="2" class="text_center editable removeOffset">
        Offset Entfernen
      </td>
    </tr>
  `;

  table.appendChild(wrapper);

  wrapper.querySelector(".removeOffset")
    .addEventListener("click", () => wrapper.remove());
}

function offset_add(obj) {
  console.log('table_'+obj.id);
  var table = document.getElementById('table_'+obj.id);
  var child = '<tr id="address_tr1_c1">' +
                '<td class="table_td_025 text_right">Adresse 1:</td>' +
                '<td class="table_td_075 editable" contenteditable="true" id="address1_c1"></td>' +
              '</tr>';
  table.appendChild(child);
}

function create_cheat_tables() {
  cheats = document.getElementById('number_cheat_tables').innerHTML;
  container.innerHTML = '';
  for (let i = 0; i < cheats; i++) {
    i++;
    container.innerHTML += ''+
  '<table class="design_border_01 design_borderspacing_01" style="cursor: default;">'+
    '<tr>'+
      '<td class="design_table_04 design_padding_01 design_text_center" colspan="2">Cheat '+i+'</td>'+
      '<td class="design_table_04 design_padding_01 design_text_center design_editable_01" onclick="offset(offset_list_'+i+', 1);">1 Offset</td>'+
      '<td class="design_table_04 design_padding_01 design_text_center design_editable_01" onclick="offset(offset_list_'+i+', 2);">2 Offsets</td>'+
    '</tr>'+
    '<tr>'+
      '<td class="design_table_04 design_padding_01 design_text_right">Beschreibung:</td>'+
      '<td class="design_table_04 design_padding_01 design_editable_01 design_text_left" colspan="3" contenteditable="true" onfocus="clean(this);" id="cheat_'+i+'_description"></td>'+
      '</tr>'+
      '<table class="design_border_01 design_borderspacing_01" style="cursor: default;" id="offset_list_'+i+'"></table>'+
    '</table>'+
    '<div class="tr_flipper_gap"></div>';
    i--;
  }
}

function offset(offset_list, offset_amount) {
  console.log(offset_list.id)
  var cheat_number = offset_list.id
  cheat_number = cheat_number.substring(cheat_number.length - 1);
  offset_list.innerHTML = '';
  for (let i = 0; i < offset_amount; i++) {
    i++;
    offset_list.innerHTML += ''+
      '<tr>'+
        '<td class="design_table_04 design_padding_01 design_text_right">Offset '+i+':</td>'+
        '<td class="design_table_04 design_padding_01 design_editable_01 design_text_left" colspan="3" contenteditable="true" onfocus="clean(this);" onblur="format_text(this);" id="cheat_'+cheat_number+'_offset_'+i+'"></td>'+
      '</tr>'+
      '<tr>'+
        '<td class="design_table_04 design_padding_01 design_text_right">Wert Aktiv:</td>'+
        '<td class="design_table_04 design_padding_01 design_editable_01 design_text_left" colspan="3" contenteditable="true" onfocus="clean(this);" onblur="format_text(this);" id="cheat_'+cheat_number+'_offset_'+i+'_on"></td>'+
      '</tr>'+
      '<tr>'+
        '<td class="design_table_04 design_padding_01 design_text_right">Wert Inaktiv:</td>'+
        '<td class="design_table_04 design_padding_01 design_editable_01 design_text_left" colspan="3" contenteditable="true" onfocus="clean(this);" onblur="format_text(this);" id="cheat_'+cheat_number+'_offset_'+i+'_off"></td>'+
      '</tr>'+
      '<tr><td class="design_table_04"></td><td class="design_table_04"></td><td class="design_table_04"></td><td class="design_table_04"></td></tr>';
    i--;
  }
}

function produce_list() {
  var game_title = document.getElementById('game_title').innerHTML;
  var game_id = document.getElementById('game_id').innerHTML;
  var game_version = document.getElementById('game_version').innerHTML;
  var game_process = document.getElementById('game_process').innerHTML;

  var br = '\n';
  var exportlist = document.getElementById('download_list');
  exportlist.innerHTML = '';
  exportlist.innerHTML += ''+
  '{'+br+
  ' "name": "'+game_title+'",'+br+
  ' "id": "'+game_id+'",'+br+
  ' "version": "'+game_version+'",'+br+
  ' "process": "'+game_process+'",'+br+
  ' "mods": ['+br;
  for (let i = 0; i < cheats; i++) {
    i++;
    var cheat_description = document.getElementById('cheat_'+i+'_description').innerHTML;
    var offset_1 = document.getElementById('cheat_'+i+'_offset_1').innerHTML;
    var on_1 = document.getElementById('cheat_'+i+'_offset_1_on').innerHTML;
    var off_1 = document.getElementById('cheat_'+i+'_offset_1_off').innerHTML;

    exportlist.innerHTML += '   {"name": "'+cheat_description+'","type": "checkbox","memory": [';
    exportlist.innerHTML += '{"offset": "'+offset_1+'",';
    exportlist.innerHTML += '"on": "'+on_1+'",';
    exportlist.innerHTML += '"off": "'+off_1+'"}';

    if (document.getElementById('cheat_'+i+'_offset_2')) {
      var offset_2 = document.getElementById('cheat_'+i+'_offset_2').innerHTML;
      var on_2 = document.getElementById('cheat_'+i+'_offset_2_on').innerHTML;
      var off_2 = document.getElementById('cheat_'+i+'_offset_2_off').innerHTML;

      exportlist.innerHTML += ',{"offset": "'+offset_2+'",';
      exportlist.innerHTML += '"on": "'+on_2+'",';
      exportlist.innerHTML += '"off": "'+off_2+'"}';
    }
    if (i == cheats) {exportlist.innerHTML += ']}'+br;}
    else {exportlist.innerHTML += ']},'+br;}
    i--;
  }
  exportlist.innerHTML += ''+
  '  ],'+br+
  '  "credits": ["Master Studios"]'+br+
  '}';
  save_list();
}

function save_list() {
  var link = document.createElement("A");
  var filename = document.getElementById('game_id').innerHTML+'_'+document.getElementById('game_version').innerHTML+'.json';

    var save_content = document.getElementById('download_list').innerHTML;

    link.setAttribute("href","data:text/xml,"+save_content);
    link.setAttribute("style","display:none");
    link.setAttribute("download",filename);
    document.body.appendChild(link);
    console.log(link.outerHTML);
    link.click();
    document.body.removeChild(link);
}
function format_text(obj) {
  var text = obj.innerHTML;
  text = text.replace(/-/gi, '');
  text = text.toUpperCase();
  obj.innerHTML = text;
}


</script>