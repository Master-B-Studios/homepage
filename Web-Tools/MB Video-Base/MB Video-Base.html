<!DOCTYPE html>
<html>
  <head>
  <title>MB Video-Base</title>
  <meta charset="utf-8"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"></meta>
  <link rel="icon" type="image/x-icon" href="../../images/MB_Icon_01.png"></link>
  <link rel="stylesheet" href="../../assets/css/main.css"></link>
  <noscript><link rel="stylesheet" href="../../assets/css/noscript.css" /></noscript>
  <script src="Scripts/xlsx.full.min.js"></script>
  <style>
    tbody {width: 100%;height: auto;}
    tr {width: 100%;height: auto;}
    .header_number_ {width: 16%;height: 4em;}
    .header_name___ {width: 16%;height: 4em;}
    .header_year___ {width: 16%;height: 4em;}
    .header_runtime {width: 16%;height: 4em;}
    .header_fsk____ {width: 16%;height: 4em;}
    .header_cover__ {width: 20%;height: 4em;}

    .table_number_ {width: 16%;height: auto;text-align: center;vertical-align: middle;background-color: #222222;}
    .table_name___ {width: 16%;height: auto;text-align: left;vertical-align: middle;background-color: #222222;padding: 2%;}
    .table_year___ {width: 16%;height: auto;text-align: center;vertical-align: middle;}
    .table_runtime {width: 16%;height: auto;text-align: center;vertical-align: middle;}
    .table_fsk____ {width: 16%;height: auto;text-align: center;vertical-align: middle;}
    .table_fsk____ img {width: 100%;height: auto;}
    .table_content {width: 16%;height: auto;text-align: justify;overflow: hidden;text-overflow: ellipsis;display: none;}
    .table_poster_ {width: 20%;height: auto;}
    .table_poster_ img {width: 100%;height: auto;}
  </style>
</head>
<body onload="window.location.href = '#mb_video_base';load_base_a_z();" class="is-preload">
  <div id="wrapper">
    
    <nav id="nav">
      <a href="../../index.html"><img class="mb_icon" src="../../images/MB_Icon_02.png"></img><span>Home</span></a>
      <a href="../../Web-Tools/web-tools.html"><img class="mb_icon" src="../../images/Web_Icon_01.png"></img><span>Web-Tools</span></a>
      <a href="../../Local-Tools/local-tools.html"><img class="mb_icon" src="../../images/CMD_Icon_01.png"></img><span>Local-Tools</span></a>
	  <a href="../../Games/games.html"><img class="mb_icon" src="../../images/Games_Icon_01.png"></img><span>Games</span></a>
      <a href="#mb_video_base"><img class="mb_icon" src="icon_01.png"></img><span>MB Video-Base</span></a>
      
    </nav>
    
    <div id="main">
      <article id="mb_video_base" class="panel">
        <header><h2>MB Video-Base</h2></header>
        
        <div id="output"></div>

      </article>
    </div>

    <div id="footer"><ul class="copyright"><li>&copy; Master B</li></ul></div>

  </div>
</body>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/browser.min.js"></script>
<script src="../../assets/js/breakpoints.min.js"></script>
<script src="../../assets/js/util.js"></script>
<script src="../../assets/js/main.js"></script>
<script>
  let aktuelleDaten = [];
  let aktuelleSortierung = {};
  
  async function load_base_a_z() {
    try {
      const response = await fetch('MB Video-Base.xlsx');
      if (!response.ok) throw new Error('Datei konnte nicht geladen werden');
      const arrayBuffer = await response.arrayBuffer();
      const data = new Uint8Array(arrayBuffer);
      const workbook = XLSX.read(data, {type: 'array'});
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const json = XLSX.utils.sheet_to_json(worksheet);
      aktuelleDaten = json;
      renderTabelle(json);
    }
    catch (err) {document.getElementById('output').textContent = 'Fehler beim Laden: ' + err.message;}
  }
  
  function renderTabelle(daten) {
    const output = document.getElementById('output');
    output.innerHTML = '';
    if (daten.length === 0) {output.textContent = 'Keine Daten gefunden.';return;}
    
    const table = document.createElement('table');
    const tbody = document.createElement('tbody');
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    
    const keys = Object.keys(daten[0]);
    for (let i = 0; i < keys.length; i++) {
      const key = keys[i];
      const th = document.createElement('th');
      th.innerHTML = key;
      if (i == 0) {th.className = 'header_number_';}
      else if (i == 1) {th.className = 'header_name___';}
      else if (i == 2) {th.className = 'header_year___';}
      else if (i == 3) {th.className = 'header_runtime';}
      else if (i == 4) {th.className = 'header_fsk____';}
      else if (i == 5) {th.className = 'header_cover__';th.innerHTML = '';}
      th.addEventListener('click', () => sortiereNachSpalte(key));
      headerRow.appendChild(th);
    }
    
    thead.appendChild(headerRow);
    table.appendChild(thead);
    
    // Datenzeilen
    for (let i = 0; i < daten.length; i++) {
      const row = daten[i];
      
      const tr1 = document.createElement('tr'); // Erste Zeile: Spalte 0–1
      const tr2 = document.createElement('tr'); // Zweite Zeile: Spalte 2–5

      var movie_id = '';
      for (let j = 0; j < keys.length; j++) {
        const key = keys[j];
        const td = document.createElement('td');
        td.innerHTML = row[key] ?? '';
        //td.textContent = row[key] ?? '';

        if (j == 0) {
          movie_id = td.innerHTML;
          td.className = 'table_number_';
          td.id = movie_id+'_number_';
          td.value = td.innerHTML;
          tr1.appendChild(td);
        }
        else if (j == 1) {
          td.className = 'table_name___';
          td.id = movie_id+'_name___';
          td.value = td.innerHTML;
          td.colSpan = 5;
          tr1.appendChild(td);
        }
        else if (j == 2) {
          td.className = 'table_year___';
          td.id = movie_id+'_year___';
          td.value = td.innerHTML;
          td.colSpan = 2;
          td.innerHTML = 'Jahr:<br>'+td.innerHTML;
          tr2.appendChild(td);
        }
        else if (j == 3) {
          td.className = 'table_runtime';
          td.id = movie_id+'_runtime';
          td.value = td.innerHTML;
          td.colSpan = 2;
          td.innerHTML = td.innerHTML+'<br>Minuten';
          tr2.appendChild(td);
        }
        else if (j == 4) {
          td.className = 'table_fsk____';
          td.id = movie_id+'_fsk____';
          td.value = td.innerHTML;
          td.innerHTML = '<img src="Scripts/'+td.value+'.png">';
          tr2.appendChild(td);
        }
        else if (j == 5) {
          td.className = 'table_poster_';
          td.id = movie_id;
          td.value = td.innerHTML;
          td.innerHTML = '<img src="Cover/'+movie_id+'.jpg">';
          td.addEventListener('click', () => download_nfo(this));
          tr2.appendChild(td);
        }
      }
      
      tbody.appendChild(tr1);
      tbody.appendChild(tr2);
    }
    
    table.appendChild(tbody);
    output.appendChild(table);
  }
  
  function sortiereNachSpalte(spalte) {
    const richtung = aktuelleSortierung[spalte] === 'asc' ? 'desc' : 'asc';
    aktuelleDaten.sort((a, b) => {
      const valA = a[spalte] ?? '';
      const valB = b[spalte] ?? '';
      return richtung === 'asc'
      ? valA.toString().localeCompare(valB.toString(), 'de', { numeric: true })
      : valB.toString().localeCompare(valA.toString(), 'de', { numeric: true });
    });
    
    aktuelleSortierung = { [spalte]: richtung };
    renderTabelle(aktuelleDaten);
  }

  function download_nfo(obj) {
    var title_movie__ = document.getElementById(obj+'_name___').value;
    var number_movie_ = document.getElementById(obj+'_number_').value;
    var runtime_movie = document.getElementById(obj+'_runtime').value;
    var year_movie___ = document.getElementById(obj+'_year___').value;
    var age_movie____ = document.getElementById(obj+'_fsk____').value;
    var content_movie = document.getElementById(obj).value;
    //if (number_movie <= 9) {number_movie = '000'+number_movie;} else if (number_movie >= 10 && number_movie <= 99) {number_movie = '00'+number_movie;} else if (number_movie >= 100 && number_movie <= 999) {number_movie = '0'+number_movie;}

    var link = document.createElement("A");var filename = title_movie+'.nfo';

    var save_content = 
    '<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>\n'+
    '<movie>\n'+
    '   <title>'+title_movie+'</title>\n'+
    '   <originaltitle>'+title_movie+'</originaltitle>\n'+
    '   <plot>'+content_movie+'</plot>\n'+
    '   <runtime>'+runtime_movie+'</runtime>\n'+
    '   <mpaa>'+age_movie+'</mpaa>\n'+
    '   <id>'+number_movie+'</id>\n'+
    '   <uniqueid type="mbdb">'+number_movie+'</uniqueid>\n'+
    '   <year>'+year_movie+'</year>\n'+
    '</movie>\n';

    link.setAttribute("href","data:text/xml,"+save_content);link.setAttribute("style","display:none");link.setAttribute("download",filename);document.body.appendChild(link);console.log(link.outerHTML);link.click();document.body.removeChild(link);
}
</script>

<script>
  function old() {

    const tbody = document.createElement('tbody');
    for (let i = 0; i < daten.length; i++) {
      const row = daten[i];
      const tr = document.createElement('tr');
      for (let j = 0; j < keys.length; j++) {
        const key = keys[j];
        const td = document.createElement('td');
        var movie_id = '';
        td.textContent = row[key] ?? '';
        if (j == 0) {td.className = 'table_number_';td.id = td.textContent;movie_id = td.id;tr.appendChild(td);}
        else if (j == 1) {td.className = 'table_name___';td.id = movie_id+'_name___';td.colSpan = 4;tr.appendChild(td);tbody.appendChild(tr);}
        else if (j == 2) {td.className = 'table_year___';td.id = movie_id+'_year___';tr.appendChild(td);}
        else if (j == 3) {td.className = 'table_runtime';td.id = movie_id+'_runtime';tr.appendChild(td);}
        else if (j == 4) {td.className = 'table_fsk____';td.id = movie_id+'_fsk____';tr.appendChild(td);td.className = 'table_poster_';td.id = movie_id+'table_poster_';tr.appendChild(td);}
        else if (j == 5) {td.className = 'table_content';td.id = movie_id+'_content';tr.appendChild(td);tbody.appendChild(tr);}
      }
    }
  }
 
</script>